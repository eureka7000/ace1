<!-- MathJAX -->
<script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>

<div class="container">
    <div class="col-md-12 bg-color-white">
        <div class="col-md-12 margin-top-20"></div>
        <div class="col-md-5">
            <p>
                <strong>개설자 : </strong>
                <% if @discussion.organizer_type == 'admin' %>
                    <%= Admin.find(@discussion.organizer).name %>
                <% else %>
                    <%= User.find(@discussion.organizer).user_name %>
                <% end %>
            </p>
        </div>
        <div class="col-md-3">
            <p>
                <strong>토론방 리더 : </strong>
                <%= @discussion.user.user_name %> <%= "(#{User::USER_TYPES[@discussion.user.user_types.first.user_type]})" %>
            </p>
        </div>

        <div class="col-md-4">
            <% @sub_leader = User.find(@discussion.sub_leader) %>
            <p>
                <strong>토론방 부리더 : </strong>
                <%= @sub_leader.user_name %> <%= "(#{User::USER_TYPES[@sub_leader.user_types.first.user_type]})" %>
            </p>
        </div>


        <div class="col-md-5">
            <p>
                <strong>운영타입 : </strong>
                <%= @discussion.manage_type %>
            </p>
        </div>
        <div class="col-md-3">
            <p>
                <strong>외부 참가자가 여부 : </strong>
                <%= @discussion.observer_yn == 'Y' ? 'YES' : 'NO' %>
            </p>
        </div>
        <div class="col-md-4">
            <p>
                <strong>선택 학년 : </strong>
                <%= @discussion.discussion_templet.grade %>
            </p>
        </div>
        <div class="col-md-5">
            <p>
                <strong>문제 수준(Level) : </strong>
                <%= @discussion.discussion_templet.level %>
            </p>
        </div>
        <div class="col-md-3">
            <p>
                <strong>Think Time(분) : </strong>
                <%= @discussion.think_time %>
            </p>
        </div>
        <div class="col-md-4">
            <p>
                <strong>토론 참가자 수 : </strong>
                <%= @discussion.participants.count %>
            </p>
        </div>
        <div class="col-md-5">
            <p>
                <strong>핵심 개념 : </strong>
                <%= @unit_concept.name %>
                (<% (1..@unit_concept.level).each do |idx| %>
                    <i class="fa fa-star" style="color: red"></i>
                <% end %>
                <% (1..5-@unit_concept.level).each do |idx| %>
                    <i class="fa fa-star-o" style="color: red"></i>
                <% end %>)
            </p>
        </div>
        <div class="col-md-3">
            <p>
                <strong>토론 시작일 : </strong>
                <%= @discussion.start_date %>
            </p>
        </div>
        <div class="col-md-4">
            <p>
                <strong>토론 종료일 : </strong>
                <%= @discussion.expiration_date %>
            </p>
        </div>
        
        <!--
        <div hidden class="col-md-4">
            <p>
                <strong>관련 개념 : </strong>

                <span style="color:red"><%= ' | ' %></span>
                <%# @unit_concept.unit_concept_descs.each do |unit_concept_desc| %>
                    <%# unless unit_concept_desc.desc_type != '5' %>
                        <%#= UnitConcept.find(unit_concept_desc.link).name %>
                        <span style="color:red"><%= ' | ' %></span>
                    <%# end %>
                <%# end %>
            </p>
        </div>
        -->

        <div class="col-md-12">
            <p>
                <strong>관련 개념 : </strong>
                <% @discussion_title_explanations.each do |discussion_title_explanation| %>
                    <%= discussion_title_explanation.unit_concept.name %>
                        <span style="color:red"><%= ' | ' %></span>
                <% end %>
            </p>
        </div>

        
        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 토론 주제</h3><br>
                    <span class="title"><%== @discussion.discussion_templet.title %></span>
            </p>
        </div>
        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 토론 문제</h3>
                    <%== @discussion.discussion_templet.content %>
            </p>
        </div>
        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 토론문제 발문 및 관련개념 </h3><br>
                <% @discussion_title_explanations.each do |discussion_title_explanation| %>
                    <div class="row col-md-12">
                            <div class="inline-group">
                                <div class="col-md-6 col-sm-6 col-xs-12 title">
                                    <%== discussion_title_explanation.content %>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 title">
                                    <%#== discussion_title_explanation.unit_concept.name %>
                                    <button class="btn btn-dropbox btn-xs rounded" onclick="moveToStudyRoom('<%= discussion_title_explanation.unit_concept_id %>')"><%== discussion_title_explanation.unit_concept.name %></button>
                                </div>
                            </div>
                    </div>
                <% end %>

                    <!--<div class="row">-->
                        <!--<div class="col-smallfa">-->
                            <!--<i class="fa fa-plane" style="color: red"></i>-->
                        <!--</div>-->
                        <!--<div class="col-content">-->
                            <%#== discussion_title_explanation.content %>
                        <!--</div>-->
                        <!--<div class="col-name">-->
                            <%#== discussion_title_explanation.unit_concept.name %>
                        <!--</div>-->
                    <!--</div>-->
            </p>
        </div>
        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 문제풀이 가이드</h3>
                <%== @discussion.discussion_templet.concept_explanation %>
            </p>
        </div>
        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 문제풀이</h3>
                <% @discussion.discussion_templet.discussion_solutions.each do |discussion_solution| %>
                    <%== discussion_solution.content %>
                    <hr>
                <% end %>
            </p>
        </div>
        <div class="col-md-12">
            <p>
                <h3>* 해답</h3>
                <%== @discussion.discussion_templet.answer %>
            </p>
        </div>


        <div class="col-md-12">
            <hr>
            <p>
                <h3>* video</h3>
                <% unless @discussion.discussion_templet.discussion_videos.blank? %>
                    <% @discussion.discussion_templet.discussion_videos.each do |discussion_video| %>
                        <div class="inline-group">
                            <div class="col-md-12 col-sm-12 col-xs-12 no-padding no-margin">
                                <%== discussion_video.content %>
                            </div>
                            <hr>
                        </div>
                    <% end %>
                <% end %>
            </p>
        </div>




        <div class="col-md-12">
            <hr>
            <p>
                <h3>* 토론문제 조건 변경 및 해답</h3>
                <%#= @discussion.interim_report %>
                <% @discussion_problem_conditions.each do |discussion_problem_condition| %>
                    <div class="row">
                        <div class="col-smallfa">
                            <i class="fa fa-plane" style="color: red"></i>
                        </div>
                        <div class="col-content">
                            <span class="title"><%== discussion_problem_condition.problem_condition %></span>
                        </div>
                        <div class="col-name">
                            <span class="title"><%== discussion_problem_condition.condition_answer %></span>
                        </div>
                    </div>
                <% end %>
            </p>
            <hr>
        </div>

        
        <!--댓글 나열-->
        <hr>
        <div class="row">
        <hr>
            <div class="col-md-12 margin-bottom-50">
                <h3>* 댓글 </h3>
                <% unless @discussion_replies.blank? %>
                    <% reply1 = 1 %>
                    <% @discussion_replies.each do |discussion_reply| %>

                        <% @discussion_replies_2 = DiscussionReply.where('group_id = ?', discussion_reply.id ).order(:group_no) %>

                        <div class="row blog-comments margin-bottom-20">
                            <div class="col-sm-1 sm-margin-bottom-10">
                                <img src="<%= discussion_reply.user.user_img.blank? ? '/assets/img/user_default_img.png' : discussion_reply.user.user_img %>" class="img-responsive rounded">
                            </div>
                            <div class="col-sm-11">
                                <div class="comments-itself">
                                    <!--댓글 단 유저 이름-->
                                    <h5>
                                        <i class="fa fa-pencil"></i><%= discussion_reply.user.nickname.blank? ? discussion_reply.user.user_name : discussion_reply.user.nickname %>
                                        <!--<span>5 hours ago / <a href="#">Reply</a></span>-->
                                    </h5>

                                    <!--댓글내용-->
                                    <span class="title"><%== discussion_reply.comment %></span>

                                    <!--<div class="margin-top-20 margin-bottom-50"><button class="btn btn-dropbox btn-sm rounded col-md-12 col-sm-12 col-xs-12" onclick="toggleReplyForm('discussion_reply_<%= reply1 %>')">댓글 달기</button></div>-->

                                    <!--대댓글 달기-->
                                    <!--<form hidden action="/discussion_reply" id="discussion_reply_<%= reply1 %>" class="margin-bottom-50" method="post" enctype="multipart/form-data" novalidate="novalidate" charset="utf-8">-->
                                        <%#= token_tag nil %>
                                        <!--<br>-->
                                        <!--<input hidden name="discussion_reply[discussion_id]" value="<%= @discussion.id %>">-->
                                        <!--<input hidden name="discussion_reply[user_id]" value="<%= current_user.id %>">-->
                                        <!--<input hidden name="discussion_reply[group_id]" value="<%= discussion_reply.id %>">-->
                                        <!--<input hidden name="discussion_reply[group_no]" value="<%= @discussion_replies_2.count + 1 %>">-->
                                        <!--<input hidden name="discussion_reply[depth]" value="<%= discussion_reply.depth + 1 %>">-->
                                        <!--버튼 클릭시 대댓글 저장-->
                                        <!--<textarea name="discussion_reply[comment]" class="post_reply_summernote margin-top-20" id="post_reply_<%= reply1 %>"></textarea>-->
                                        <!--<input type="button" class="btn btn-windows rounded col-md-12 col-sm-12 col-xs-12" onclick="commentFilter('<%= reply1 %>')" value="댓글 저장">-->
                                    <!--</form>-->
                                </div>
                            </div>
                        </div>

                        <% unless @discussion_replies_2.nil? %>
                            <% reply1 = reply1 + 1 %>
                            <% @discussion_replies_2.each do |discussion_reply_2| %>

                                <% @discussion_replies_3 = DiscussionReply.where('group_id = ?', discussion_reply_2.id ).order(:group_no) %>

                                <div class="row blog-comments blog-comments-reply margin-bottom-30">
                                    <div class="col-sm-1 sm-margin-bottom-10">
                                        <img src="<%= discussion_reply_2.user.user_img.blank? ? '/assets/img/user_default_img.png' : discussion_reply_2.user.user_img %>" class="img-responsive rounded">
                                    </div>
                                    <div class="col-sm-11">
                                        <div class="comments-itself">
                                            <!--댓글 단 유저 이름-->
                                            <h5>
                                                <i class="fa fa-pencil-square-o"></i><%= discussion_reply_2.user.nickname.blank? ? discussion_reply_2.user.user_name : discussion_reply_2.user.nickname %>
                                                <!--<span>6 hours ago / <a href="#">Reply</a></span>-->
                                            </h5>

                                            <!--댓글내용-->
                                            <span class="title"><%== discussion_reply_2.comment %></span>

                                            <!--<div class="margin-top-20 margin-bottom-50"><button class="btn btn-dropbox btn-sm rounded col-md-12 col-sm-12 col-xs-12" onclick="toggleReplyForm('discussion_reply_<%= reply1 %>')">댓글 달기</button></div>-->

                                            <!--대댓글 달기-->
                                            <!--<form hidden action="/discussion_reply" id="discussion_reply_<%= reply1 %>" class="margin-bottom-50" method="post" enctype="multipart/form-data" novalidate="novalidate" charset="utf-8">-->
                                                <%= token_tag nil %>
                                                <!--<br>-->
                                                <!--<input hidden name="discussion_reply[discussion_id]" value="<%#= @discussion.id %>">-->
                                                <!--<input hidden name="discussion_reply[user_id]" value="<%#= current_user.id %>">-->
                                                <!--<input hidden name="discussion_reply[group_id]" value="<%#= discussion_reply_2.id %>">-->
                                                <!--<input hidden name="discussion_reply[group_no]" value="<%#= @discussion_replies_3.count + 1 %>">-->
                                                <!--<input hidden name="discussion_reply[depth]" value="<%#= discussion_reply_2.depth + 1 %>">-->
                                                <!--버튼 클릭시 대댓글 저장-->
                                                <!--<textarea name="discussion_reply[comment]" class="post_reply_summernote margin-top-20" id="post_reply_<%= reply1 %>"></textarea>-->
                                                <!--<input type="button" class="btn btn-windows rounded col-md-12 col-sm-12 col-xs-12" onclick="commentFilter('<%= reply1 %>')" value="댓글 저장">-->
                                            <!--</form>-->

                                        </div>
                                    </div>
                                </div>

                                <% unless @discussion_replies_3.nil? %>
                                    <% reply1 = reply1 + 1 %>
                                    <% @discussion_replies_3.each do |discussion_reply_3| %>

                                        <div class="row blog-comments blog-comments-reply margin-bottom-30">
                                            <div class="col-sm-1 col-xs-0 sm-margin-bottom-10"></div>
                                            <div class="col-sm-1 col-sm-offset-0 col-xs-offset-1 sm-margin-bottom-10">
                                                <img src="<%= discussion_reply_3.user.user_img.blank? ? '/assets/img/user_default_img.png' : discussion_reply_3.user.user_img %>" class="img-responsive rounded">
                                            </div>
                                            <div class="col-sm-10 col-sm-offset-0 col-xs-offset-1 col-xs-11">
                                                <div class="comments-itself">
                                                    <!--댓글 단 유저 이름-->
                                                    <h5>
                                                        <i class="fa fa-pencil-square-o"></i><%= discussion_reply_3.user.nickname.blank? ? discussion_reply_3.user.user_name : discussion_reply_3.user.nickname %>
                                                        <!--<span>6 hours ago / <a href="#">Reply</a></span>-->
                                                    </h5>

                                                    <!--댓글내용-->
                                                    <span class="title"><%== discussion_reply_3.comment %></span>
                                                </div>
                                            </div>
                                        </div>
                                        <% reply1 = reply1 + 1 %>
                                    <% end %>
                                <% end %>

                                <% reply1 = reply1 + 1 %>
                            <% end %>
                        <% end %>

                        <% reply1 = reply1 + 1 %>
                    <% end %>

                <% end %>

            </div>
        </div>





        <div class="col-md-12 margin-bottom-50">
            <hr>
            <p>
                <h3>* 종합 의견</h3><br>
                <span class="title"><%== @discussion.final_report %></span>
            </p>
            <hr>
        </div>

        <!--<div class="col-md-12 col-sm-12 col-xs-12 margin-bottom-50">-->
            <!--<hr><!-->
            <%#= link_to 'Edit', edit_discussion_path(@discussion), :class => 'btn btn-windows rounded col-md-5 col-sm-5 col-xs-5' %>
            <!--<div class="col-md-2 col-sm-2 col-xs-2"></div>-->
            <%#= link_to 'Back', discussions_path(:school_id => @discussion.user.school_id), :class => 'btn btn-podcast rounded col-md-5 col-sm-5 col-xs-5' %>
        <!--</div>-->

        <hr>
                <!--<a href="/discussions/discussion_list"><button class="btn btn-podcast col-md-12 col-sm-12 col-xs-12 rounded margin-bottom-50">뒤로가기</button></a>-->
                <a href="/discussions/discussion_list"><button class="btn btn-podcast col-md-12 col-sm-12 col-xs-12 rounded margin-bottom-50">뒤로가기</button></a>
    </div>
</div>

<style>
    div.col-smallfa {
    position: relative;
    margin-left: 15px;
    width: 2%;
    display: inline-block;
}

div.col-content {
    position: relative;
    width: 60%;
    display: inline-block;
}

div.col-name {
    position: relative;
    width: 34%;
    display: inline-block;
}
</style>

<style>
span.title {
    font-size: 18px;
}
div.title {
    font-size: 18px;
}

.note-editable {
    font-size: 18px;
    font-weight: normal;
    line-height: 1.2;
}
</style>




